$ie11-support: false !default;

$bfg-gap: 1rem !default;

$bfg-padding: 0.5rem !default;

$bfg-header-height: 2rem !default;

$bfg-fill-default: (
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.075),
  border-radius: 3px,
  border-width: 1px,

  header-border: #d5d5d5,
  header-background: #f6f6f6,
  header-forground: false,

  content-border: #ddd,
  content-background: #fff,
  content-forground: false
) !default;

$bfg-fill-default-included: true;

$bfg-breakpoints: (
  xs: 576px,
  sm: 768px,
  lg: 992px,
  xl: 1200px
) !default;

@mixin bfg-media-breakpoint-up($size) {
  @media (min-width: map-get($bfg-breakpoints, $size)) {
    @content;
  }
}

@mixin bfg-media-breakpoint-down($size) {
  @media (max-width: map-get($bfg-breakpoints, $size) - 0.02) {
    @content;
  }
}

.bfg {
  display: flex;
  height: 100%; // Try to fit the parent node height when available

  .bfg {
    height: auto;
  }
}

.bfg--row {
  flex-direction: row;
}

.bfg--col {
  flex-direction: column;
}

.bfg--gap {
  margin: 0 (-$bfg-gap / 2);

  .bfg__box {
    padding: 0 ($bfg-gap / 2) $bfg-gap ($bfg-gap / 2);
  }

  .bfg {
    padding: 0;
  }
}

.bfg--wrap {
  flex-wrap: wrap;
}

.bfg__box {
  flex: 0 1 100%;
  position: relative;
  overflow: auto;
  box-sizing: border-box;
}

@if $ie11-support {
  .bfg--row > .bfg__box { max-width: 100%; }
  .bfg--col > .bfg__box { max-height: 100%; }
}

.bfg__box--fixed {
  flex: 0 0 auto;
}

@mixin bfg-boxes($size: '') {
  .bfg__box--#{$size + 1} { flex-basis: (100% / 12); }
  .bfg__box--#{$size + 2} { flex-basis: (100% / 6); }
  .bfg__box--#{$size + 3} { flex-basis: 25%; }
  .bfg__box--#{$size + 4} { flex-basis: (100% / 3); }
  .bfg__box--#{$size + 5} { flex-basis: (500% / 12); }
  .bfg__box--#{$size + 6} { flex-basis: 50%; }
  .bfg__box--#{$size + 7} { flex-basis: (700% / 12); }
  .bfg__box--#{$size + 8} { flex-basis: (200% / 3); }
  .bfg__box--#{$size + 9} { flex-basis: 75%; }
  .bfg__box--#{$size + 10} { flex-basis: (1000% / 12); }
  .bfg__box--#{$size + 11} { flex-basis: (1100% / 12); }
  .bfg__box--#{$size + 12} { flex-basis: 100%; }

  .bfg--row {
    @if $ie11-support {
      > .bfg__box--#{$size + 1} { max-width: (100% / 12); }
      > .bfg__box--#{$size + 2} { max-width: (100% / 6); }
      > .bfg__box--#{$size + 3} { max-width: 25%; }
      > .bfg__box--#{$size + 4} { max-width: (100% / 3); }
      > .bfg__box--#{$size + 5} { max-width: (500% / 12); }
      > .bfg__box--#{$size + 6} { max-width: 50%; }
      > .bfg__box--#{$size + 7} { max-width: (700% / 12); }
      > .bfg__box--#{$size + 8} { max-width: (200% / 3); }
      > .bfg__box--#{$size + 9} { max-width: 75%; }
      > .bfg__box--#{$size + 10} { max-width: (1000% / 12); }
      > .bfg__box--#{$size + 11} { max-width: (1100% / 12); }
      > .bfg__box--#{$size + 12} { max-width: 100%; }
    }

    &.bfg--#{$size + lines-2} > .bfg__box { height: 50%; }
    &.bfg--#{$size + lines-3} > .bfg__box { height: (100% / 3); }
    &.bfg--#{$size + lines-4} > .bfg__box { height: 25%; }
  }

  .bfg--col {
    @if $ie11-support {
      > .bfg__box--#{$size + 1} { max-height: (100% / 12); }
      > .bfg__box--#{$size + 2} { max-height: (100% / 6); }
      > .bfg__box--#{$size + 3} { max-height: 25%; }
      > .bfg__box--#{$size + 4} { max-height: (100% / 3); }
      > .bfg__box--#{$size + 5} { max-height: (500% / 12); }
      > .bfg__box--#{$size + 6} { max-height: 50%; }
      > .bfg__box--#{$size + 7} { max-height: (700% / 12); }
      > .bfg__box--#{$size + 8} { max-height: (200% / 3); }
      > .bfg__box--#{$size + 9} { max-height: 75%; }
      > .bfg__box--#{$size + 10} { max-height: (1000% / 12); }
      > .bfg__box--#{$size + 11} { max-height: (1100% / 12); }
      > .bfg__box--#{$size + 12} { max-height: 100%; }
    }

    &.bfg--#{$size + lines-2} > .bfg__box { width: 50%; }
    &.bfg--#{$size + lines-3} > .bfg__box { width: (100% / 3); }
    &.bfg--#{$size + lines-4} > .bfg__box { width: 25%; }
  }

  .bfg--#{$size + disabled} {
    display: block;
    height: auto;

    .bfg__box {
      display: block;
      max-width: none;
      max-height: none;
      width: auto;
      height: auto;
    }
  }
}

@include bfg-boxes(); // any screen size even greater than "xl"

@include bfg-media-breakpoint-down(xl) {
  @include bfg-boxes(xl-);
}

@include bfg-media-breakpoint-down(lg) {
  @include bfg-boxes(lg-);
}

@include bfg-media-breakpoint-down(sm) {
  @include bfg-boxes(sm-);
}

@include bfg-media-breakpoint-down(xs) {
  @include bfg-boxes(xs-);
}

.bfg__action,
.bfg__header {
  padding: 0 $bfg-padding;
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
  height: $bfg-header-height;
  line-height: $bfg-header-height;
  font-size: 1rem;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.bfg__action {
  float: right;
  max-width: 25%; // Up to 4 actions per box

  + .bfg__action,
  + .bfg__header {
    box-shadow: none;
    border-top-right-radius: 0;
    border-right-width: 0;
  }
}

.bfg__content {
  padding: $bfg-padding;
  box-sizing: border-box;
  position: relative;
  overflow: auto;
  width: 100%;
  height: 100%;
}

.bfg__content--nopad {
  padding: 0;
}

.bfg__header + .bfg__content {
  height: calc(100% - #{$bfg-header-height});
  border-top: none;
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}

.bfg--box-overflow .bfg__box,
.bfg--content-overflow .bfg__content,
.bfg__box--overflow,
.bfg__content--overflow {
  overflow: visible;
}

@mixin bfg-filler($name, $fill) {
  $fill: map-merge($bfg-fill-default, $fill);

  .bfg__action--#{$name},
  .bfg__header--#{$name} {
    box-shadow: map-get($fill, box-shadow);
    border: map-get($fill, border-width) solid map-get($fill, header-border);
    background-color: map-get($fill, header-background);
    @if map-get($fill, header-forground) { color: map-get($fill, header-forground); }
    line-height: calc(#{$bfg-header-height} - #{2 * map-get($fill, border-width)});
  }

  .bfg__action--#{$name} {
    border-top-right-radius: map-get($fill, border-radius);
    border-left-width: 0;
  }

  .bfg__header--#{$name} {
    border-radius: map-get($fill, border-radius) map-get($fill, border-radius) 0 0;
  }

  .bfg__content--#{$name} {
    box-shadow: map-get($fill, box-shadow);
    border-radius: map-get($fill, border-radius);
    border: map-get($fill, border-width) solid map-get($fill, content-border);
    background-color: map-get($fill, content-background);
    @if map-get($fill, content-forground) { color: map-get($fill, content-forground); }
  }
}

@if $bfg-fill-default-included {
  @include bfg-filler(default, $bfg-fill-default);
}
